# 営業タスク管理ツール - 仕様書

## システム概要
営業チーム向けのタスク管理ツール「Buzzlog」。Firebase Hostingでデプロイされており、複数ユーザーでのタスク管理が可能。

## URL
- 本番環境: https://buzzlog-6fc74.web.app
- Firebase Console: https://console.firebase.google.com/project/buzzlog-6fc74/overview

## ログイン情報

### 人員マスター連動ログイン
人員マスターに登録されている人のみログイン可能

| ユーザー名 | パスワード | 備考 |
|----------|----------|------|
| 山田太郎 | yamada123 | 初期登録メンバー |
| 佐藤花子 | sato123 | 初期登録メンバー |
| 鈴木一郎 | suzuki123 | 初期登録メンバー |
| pialabuzz | pialabuzz1234 | 管理者用（互換性維持） |

※ 新規追加した人員は、名前の最初の2文字（小文字） + `123` がパスワードになります

## 主要機能

### 1. タスク管理
- **タスクタイプ**: 部署タスク、プロジェクトタスク、個人タスク
- **優先度設定**: 高（赤↑）、中（黄→）、低（青↓）
- **ステータス管理**: 未対応、処理中、処理完了、終了
- **担当者設定**: 全タスクタイプで複数担当者設定可能（チェックボックス形式）
- **期限管理**: 開始日・終了日の設定

### 2. 通知機能
- ダッシュボードのヘッダーにベルマークアイコン
- 自分が担当者のタスクに変更があった場合に通知
  - タスク内容の変更
  - ステータスの変更
  - 他者からのコメント追加
- 通知クリックで該当タスク詳細へ遷移
- 変更箇所が2秒間ハイライト表示

### 3. フィルタリング・ソート機能
- **カテゴリフィルタ**: タスクタイプ別表示
- **担当者フィルタ**: 担当者で絞り込み（複数担当者対応）
- **ステータスフィルタ**: 進捗状況で絞り込み
- **プロジェクトフィルタ**: プロジェクト名で絞り込み
- **並び替え**: 優先度順、開始日順、終了日順、ステータス順

### 4. マスター管理
- **人員マスター**: チームメンバーの管理（ログインユーザーと連動）
- **プロジェクトマスター**: プロジェクトの管理

### 5. タスク詳細機能
- **タスク情報の編集**: タスクタイプ、ステータス、担当者、プロジェクト、内容、期限の編集
- **タスクタイプ変更**: 部署タスク、プロジェクトタスク、個人タスクの変更可能
- **プロジェクト連動**: プロジェクトタスクに変更時、プロジェクト選択が自動表示
- **コメント機能**: 「見ました」ボタンで任意の既読マーク
- **変更履歴の自動記録**: 全ての変更を履歴として保存
- **担当者への通知**: コメント追加時に全担当者へ通知

### 6. タスクID機能
- **ランダム英数字形式**: T-YYYYMMDD-XXXXX形式（5文字のランダム英数字）
- **直接検索**: ダッシュボードの検索窓でタスクIDを直接入力して検索
- **重複防止**: 60,466,176通りの組み合わせで重複可能性が極めて低い
- **既存データ対応**: 既存タスクのIDは変更せず、新規作成時のみランダムID適用

### 7. 未読コメント表示
- **電球アイコン**: 未読コメントがあるタスクの最初の担当者名の右に💡マークを表示
- **表示ルール**: コメントなし→非表示、コメント全て既読→非表示、未読コメントあり→表示
- **アニメーション効果**: 電球アイコンは光るアニメーションで注意を引く
- **担当者バッジ色分け**: 動的な色割り当てで20色から自動選択（色重複を完全に回避）

### 8. 複数担当者機能
- **チェックボックス選択**: タスク作成・編集時に複数担当者を選択可能
- **カラーバッジ表示**: 担当者ごとに異なる色のバッジで表示
- **フィルタリング対応**: 複数担当者のいずれかで絞り込み検索可能
- **通知機能**: 全担当者に通知を送信
- **未読表示仕様**: 電球アイコンは最初の担当者のみに表示
- **削除機能**: ステータスが「終了」のタスクのみ削除可能

## 表示仕様

### タスク一覧（コンパクト表示）
- 1タスクの高さを最小限に抑えた設計
- 横一列レイアウト: [タスクID] [タスク名] [優先度] [ステータス] [期限] [プロジェクト名] [複数担当者バッジ] [詳細/削除]
- 多数のタスクを一覧で確認可能
- プロジェクトタスクは紫色のバッジでプロジェクト名を表示
- 複数担当者は色分けされたバッジで横並び表示

### 優先度表示
- **高**: 赤色の上矢印（↑）
- **中**: 黄色の右矢印（→）
- **低**: 青色の下矢印（↓）

### ステータス表示
- 色分けされたバッジ形式
- 視認性の高いデザイン

## 技術仕様

### フロントエンド
- HTML/CSS/JavaScript（バニラJS）
- LocalStorage でデータ管理
- レスポンシブデザイン対応

### ホスティング
- Firebase Hosting
- デプロイコマンド: `firebase deploy`

### ファイル構成
```
/
├── index.html          # ログイン画面
├── dashboard.html      # メイン画面
├── task-detail.html    # タスク詳細画面
├── auth.js            # 認証処理
├── app.js             # メインアプリケーション
├── data.js            # データ管理
├── task-detail.js     # タスク詳細処理
├── styles.css         # スタイルシート
└── firebase.json      # Firebase設定
```

## 開発時の注意事項

### コード規約
- コメントは必要最小限に
- 既存のコードスタイルに従う
- セキュリティに配慮（秘密情報の扱い）

### デプロイ
- 機能実装・修正完了後は必ず `firebase deploy` を実行
- デプロイ完了を確認してから作業終了

### テスト
- ブラウザキャッシュのクリア（Ctrl+F5）を推奨
- 複数ユーザーでの動作確認

## 更新履歴

### 最新の更新
1. マルチユーザー対応（人員マスター連動ログイン）
2. 通知機能の実装
3. 優先度機能の追加
4. タスク一覧のコンパクト表示化
5. フィルタリング機能の改善
6. タスクID機能の追加（T-YYYYMMDD-001形式）
7. タスクID直接検索機能の実装
8. コメント「見ました」機能の追加（任意の既読チェック）
9. 未読コメントの電球アイコン表示機能
10. 担当者バッジの色分け機能（動的色割り当てで重複完全回避）
11. プロジェクト名フィルタリング機能の追加
12. ステータス「終了」タスクの削除機能
13. Buzzlogブランドリニューアル（ロゴ・デザイン更新）
14. **複数担当者機能の実装**
    - チェックボックス形式での複数選択
    - 複数担当者のカラーバッジ表示
    - フィルタリング・通知システムの複数対応
    - 電球アイコンは最初の担当者のみ表示（要望通り）
    - 既存データの自動移行処理
15. **プロジェクト名表示機能の追加**
    - タスク一覧でプロジェクトタスクにプロジェクト名バッジを表示
    - 紫色のバッジで視認性向上
16. **電球マーク表示ルールの改善**
    - コメントが存在しない場合は電球マーク非表示
    - 全てのコメントが既読の場合は電球マーク非表示
    - 未読コメントがある場合のみ電球マーク表示
17. **タスクID重複問題の解決**
    - ランダム英数字（5文字）での新規ID生成に変更
    - 既存タスクIDは保持、新規作成時のみランダムID適用
    - 60,466,176通りの組み合わせで重複リスクを大幅軽減
18. **タスク詳細画面でのタスクタイプ編集機能**
    - タスクタイプ（部署タスク/プロジェクトタスク/個人タスク）を編集可能
    - プロジェクトタスクに変更時、プロジェクト選択が自動表示
    - タスクタイプ変更時の適切な表示制御を実装

## トラブルシューティング

### 機能が表示されない場合
1. ブラウザキャッシュをクリア（Ctrl+Shift+R）
2. シークレットモードで確認
3. Firebase デプロイの反映待ち（数分かかる場合あり）

### ログインできない場合
1. 人員マスターに登録されているか確認
2. パスワードルールを確認（苗字ローマ字+123）
3. 大文字小文字の入力ミスを確認